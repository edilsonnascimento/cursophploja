10 - Alterando produtos

01 - Alterando produtos

- Incluir opção alterar na lista de produto.
Botão um link para formulário altera produto passado id do produto que deve ser alterado.
<td>
	<a class="btn btn-primary" href="produto-formulario-altera.php?id=<?=$produto['id']?>">alterar</a>
</td>

- Receber ID da listagem
$id = $_GET['id'];

# Criar busca de produto pelo id

- Incluir classe de produtos-banco.php.
include("produto-banco.php");

- Criar método buscaProduto pelo id.
$produto = buscaProduto($conexao, $id);

- Criar método no produto-banco que retorna um objeto produto.
function buscaProduto($conexao, $id){
	$query = "select * from produtos where id = {id}";
	$resultado mysqli_query($conxao, $query);
	return mysqli_fetch_assoc(resultado);
}

- Preecher campos do formuário com o objeto produto carregado.
<input class="form-control" type="text" name="nome" value="<?=$produto['nome']?>">
<input class="form-control" type="number" name="preco" value="<?=$produto['preco']?>">
<textarea class="form-control" type="text" name="descricao"><?=$produto['descricao']?></textarea>

- Preenchimento diferenciado para Checkbox
Verifica se o campo está preechido e check o chekbox do formuário.
<td>
	<?php $usado = $produto['usado'] ? "checked='checked'" : "";?>
	<input type="radio" name="usado" <?=$usado?> value="true">
	Usado
</td>   	

- Preenchimento campo seletor verifica se a categoria é igual a categria do produto.
<td>
	<select name="categoria_id">
		<?php 
			foreach ($categorias as $categoria) :  
				$essaEhAcategoriaProduto = $produto['categoria_id'] == $categoria['id'];
				$selecao = $essaEhAcategoriaProduto ? "selected='selected'" : "";?>
				<option value="<?=$categoria['id']?>" <?=$selecao?>>
				<?=$categoria['nome']?>
				</option>			    					
		<?php endforeach ?>		    			
	</select>
</td>


- Criar classe para receber o formulário e chamar método de para alterar.
<?php 
	include("cabecalho.php");
    include("produto-banco.php");

    $id = $_POST['id'];
	$nome = $_POST['nome'];
	$preco = $_POST['preco'];
	$descricao = $_POST['descricao'];
	$categoria_id = $_POST['categoria_id'];

	if(array_key_exists('usado', $_POST)){
		$usado = "true";
	}else{
		$usado = "false";
	}
	

	if (altereProduto($conexao, $id, $nome, $preco, $descricao, $categoria_id, $usado)){
		?> <p class="text-success">Produto <?php echo $nome; ?> no valor de  <?php echo $preco?> adicionado com sucesso!</p> <?php            		
	} else{
		?> <p class="text-danger">Produto NÃO pode ser adicionado!</p> 
		<?php $msg = mysql_error($conexao);
	} ?>

<?php include("rodape.php");?>

- Criar método altereProduto.
function altereProduto($conexao, $id, $nome, $preco, $descricao, $categoria_id, $usado){
	$query = "update produtos set nome='{$nome}', preco={$preco}, descricao='{$descricao}', categoria_id={$categoria_id}, usado={$usado} where id = {$id}";
	echo $query;
	return mysqli_query($conexao, $query);
}	

